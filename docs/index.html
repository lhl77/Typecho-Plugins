<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Typecho 插件集合</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Icons+Outlined" rel="stylesheet">
  <link rel="stylesheet" href="/docs/style.css">
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js"></script>
</head>
<body>
  <header class="topbar">
    <div class="topbar-inner">
      <h1 class="title">Typecho 插件集合</h1>
      <p class="subtitle">浏览、搜索并查看流行的 Typecho 插件</p>
      <div class="search-row">
        <input id="searchInput" type="search" placeholder="搜索插件：名称、描述或作者" aria-label="搜索插件">
        <button id="clearBtn" title="清除">清除</button>
      </div>
    </div>
  </header>

  <main class="container">
    <section id="stats" class="stats">
      <div>插件数量：<span id="count">0</span></div>
    </section>

    <section id="results" class="grid"></section>
  </main>

  <template id="card-template">
    <article class="card">
      <div class="card-header">
        <div class="card-title"></div>
        <div class="card-author"></div>
      </div>
      <p class="card-desc"></p>
      <div class="card-meta">
        <span class="tag"></span>
        <a class="link" target="_blank" rel="noopener noreferrer">仓库</a>
      </div>
    </article>
  </template>

  <script>
  // Load plugins.json and initialize Fuse.js search
  async function loadPlugins() {
    const res = await fetch('/docs/plugins.json');
    const plugins = await res.json();
    return plugins;
  }

  function renderList(list) {
    const container = document.getElementById('results');
    container.innerHTML = '';
    const tpl = document.getElementById('card-template');
    list.forEach(p => {
      const node = tpl.content.cloneNode(true);
      node.querySelector('.card-title').textContent = p.name;
      node.querySelector('.card-author').textContent = p.author || '';
      node.querySelector('.card-desc').textContent = p.description || '';
      node.querySelector('.tag').textContent = p.tags ? p.tags.join(' · ') : '';
      const link = node.querySelector('.link');
      link.href = p.url || '#';
      link.textContent = p.url ? '仓库' : '';
      container.appendChild(node);
    });
    document.getElementById('count').textContent = list.length;
  }

  (async ()=>{
    const plugins = await loadPlugins();
    const options = {
      keys: [
        {name: 'name', weight: 0.6},
        {name: 'description', weight: 0.3},
        {name: 'author', weight: 0.1},
        'tags'
      ],
      threshold: 0.35
    };
    const fuse = new Fuse(plugins, options);

    // initial render
    renderList(plugins);

    const input = document.getElementById('searchInput');
    const clearBtn = document.getElementById('clearBtn');

    input.addEventListener('input', ()=>{
      const q = input.value.trim();
      if(!q) { renderList(plugins); return; }
      const results = fuse.search(q).map(r=>r.item);
      renderList(results);
    });

    clearBtn.addEventListener('click', ()=>{
      input.value = '';
      renderList(plugins);
      input.focus();
    });
  })();
  </script>
</body>
</html>
